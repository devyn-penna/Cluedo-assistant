<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cluedo Assistant</title>
<style>
body{ font-family:Arial,sans-serif; background:#1a1a1a; color:#e5e5e5; margin:0; padding:0;}
h1,h2{margin:10px 0;}
label{display:block; margin-top:10px; font-weight:bold;}
input,select{width:100%; padding:6px; margin-top:4px; border-radius:6px; border:none; background:#2d2d2d; color:#e5e5e5;}
button{padding:8px 12px; border-radius:8px; border:none; background:#4b5563; color:white; cursor:pointer; transition:.2s; margin-top:10px;}
button:hover{background:#6b7280;}
button.danger{background:#dc2626;}
.panel{ background:#111; padding:20px; border-radius:14px; margin:20px auto; max-width:1200px; }
.grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:12px; margin-top:10px; }
.card{ background:#2d2d2d; padding:12px; border-radius:12px; text-align:center; cursor:pointer; position:relative; transition:transform .3s, box-shadow .3s, opacity .3s; }
.card.selected{ outline:3px solid #3b82f6; }
.card.eliminated{ background:#dc2626; opacity:.6; }
.card.uncertain::after{ content:"?"; position:absolute; top:2px; right:6px; font-size:26px; font-weight:bold; color:#3b82f6; }
.card.clue-reveal{ animation:clueFlip .8s ease forwards; box-shadow:0 0 20px #3b82f6; }
@keyframes clueFlip{0%{ transform:rotateY(90deg); opacity:0 }50%{ opacity:1 }100%{ transform:rotateY(0deg) }}
.player-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(110px,1fr)); gap:10px; margin-top:8px; }
.player-btn{ background:#374151; padding:10px; border-radius:12px; text-align:center; cursor:pointer; position:relative; }
.player-btn.selected{ background:#2563eb; }
.player-btn.selected::after{ content:"üîµ"; position:absolute; top:4px; right:6px; }
.greyed{ opacity:.35; pointer-events:none; }
#stickyBar{ position:sticky; top:0; background:#111; padding:10px 20px; border-bottom:2px solid #3b82f6; z-index:999; display:flex; justify-content:space-between; align-items:center;}
#logPanel{ position:fixed; bottom:0; left:0; right:0; background:#111; max-height:250px; overflow-y:auto; border-top:2px solid #3b82f6; padding:15px; display:none; font-size:14px;}
#logPanel div{ padding:6px 0; border-bottom:1px solid #2d2d2d; }
.flash{ animation:flashAnim .5s ease; }
@keyframes flashAnim{ 0%{ background:#3b82f6 }50%{ background:#4b5563 }100%{ background:#3b82f6 }}
.flex-row{ display:flex; gap:10px; }
.flex-row select{ flex:1; }
.log-card{ display:inline-block; padding:2px 6px; border-radius:6px; margin-right:4px; margin-bottom:2px; font-size:12px; }
.log-card.seen{background:#10b981; color:#111;}
.log-card.elim{background:#dc2626; color:white;}
.log-card.unknown{background:#6b7280; color:white;}
</style>
</head>
<body>

<div id="stickyBar">
  <div><strong>Current Turn:</strong> <span id="currentPlayer">‚Äì</span></div>
  <button id="logToggle" onclick="toggleLog()">Show Log</button>
</div>

<div class="panel">
<h1>üïµÔ∏è Cluedo Assistant</h1>
<h2>Setup ‚Äì Your Starting Hand</h2>
<div class="grid" id="setupCards"></div>
</div>

<div class="panel" id="setupPanel">
<h2>Players Setup</h2>
<label>Players (comma separated)</label>
<input id="playersInput" placeholder="Devyn,Lisa,Caiden,Xavier,Leo">
<button onclick="setPlayers()">Set Players</button>
<label>I am:</label>
<select id="currentUserSelect" onchange="currentUser=this.value"></select>
<button style="background:#2563eb;color:white;" onclick="confirmSetup()">Confirm</button>
</div>

<div class="panel">
<h2>Current Go</h2>
<div class="flex-row">
  <div>
    <label>Person</label>
    <select id="guessPerson"></select>
  </div>
  <div>
    <label>Weapon</label>
    <select id="guessWeapon"></select>
  </div>
  <div>
    <label>Room</label>
    <select id="guessRoom"></select>
  </div>
</div>

<label>What happened?</label>
<select id="result" onchange="handleResultChange()">
  <option value="shown">A card was shown and I saw it</option>
  <option value="unknownshow">A card was shown but I didn‚Äôt see it</option>
  <option value="noshow">No one could show</option>
  <option value="clue">Random clue card revealed</option>
</select>

<div id="clueSeenWrapper" style="display:none; margin-top:10px;">
  <label><input type="checkbox" id="clueNotSeen"> I didn‚Äôt see the clue card</label>
</div>

<label>Who showed a card? (select all)</label>
<div class="player-grid" id="playerShownGrid"></div>

<label>Which card(s) were shown?</label>
<div class="grid" id="shownCardGrid"></div>

<div style="display:flex; gap:10px; margin-top:15px;">
<button id="processBtn" style="flex:1;" onclick="processTurnWithFlash(this)">Process Event</button>
<button id="endBtn" style="flex:1;" onclick="nextTurnWithFlash(this)">End Turn</button>
</div>
</div>

<h2>Probabilities</h2>
<div class="grid" id="cards"></div>
<button class="danger" onclick="suggest()">üéØ Most Likely Guess</button>
<h2 id="suggestion"></h2>

<div id="logPanel"></div>

<script>
// =================== Data ===================
const people=["Devyn","Lisa","Caiden","Xavier","Leo","Claudia"];
const weapons=["Dave","Pool Stick","Nerf Gun","Cricket Bat","Knife","Banana"];
const rooms=["Playroom","Bathroom","Devyns Bedroom","Lisas Bedroom","Caicens Bedroom","Kitchen","Toilet","Dining Room","Lounge"];
const allCards=[...people,...weapons,...rooms];

let prob={}, eliminated={}, uncertain={};
let players=[], turnIndex=0, currentUser="";
let playersWhoShowed=new Set();
let shownCards=new Set();
let playerCards={};

allCards.forEach(c=>{ prob[c]=1; eliminated[c]=false; uncertain[c]=false; });

// =================== Functions ===================
function setPlayers(){
  players=playersInput.value.split(",").map(p=>p.trim()).filter(Boolean);
  turnIndex=0;
  document.getElementById("currentPlayer").innerText=players[0]||"‚Äì";
  players.forEach(p=>playerCards[p]=[]);
  renderPlayers();
}

function confirmSetup(){
  document.getElementById("setupPanel").style.display="none";
  document.getElementById("currentPlayer").innerText=players[0]||"‚Äì";
  renderPlayers();
}

function renderPlayers(){
  currentUserSelect.innerHTML="";
  players.forEach(p=>currentUserSelect.add(new Option(p,p)));
  currentUser=currentUserSelect.value;
  playerShownGrid.innerHTML="";
  players.forEach(p=>{
    const d=document.createElement("div");
    d.className="player-btn"+(playersWhoShowed.has(p)?" selected":"");
    d.innerText=p;
    d.onclick=()=>{ playersWhoShowed.has(p)?playersWhoShowed.delete(p):playersWhoShowed.add(p); renderPlayers(); };
    playerShownGrid.appendChild(d);
  });
}

function renderShownCards(){
  shownCardGrid.innerHTML="";
  allCards.forEach(c=>{
    const d=document.createElement("div");
    d.className="card"+(shownCards.has(c)?" selected":"");
    d.innerText=c;
    d.onclick=()=>{ shownCards.has(c)?shownCards.delete(c):shownCards.add(c); renderShownCards(); };
    shownCardGrid.appendChild(d);
  });
}

function handleResultChange(){
  const isClue=result.value==="clue";
  clueSeenWrapper.style.display=isClue?"block":"none";
  playerShownGrid.classList.toggle("greyed",isClue);
}

function normalize(arr){ let t=arr.reduce((s,c)=>s+prob[c],0); arr.forEach(c=>prob[c]=t?prob[c]/t:0);}
function normalizeAll(){normalize(people);normalize(weapons);normalize(rooms);}

function processTurn(){
  const res=result.value;
  const didntSee=clueNotSeen.checked;

  if(res==="shown" || (res==="clue" && !didntSee)){
    playersWhoShowed.forEach(player=>{
      if(!playerCards[player]) playerCards[player]=[];
      shownCards.forEach(c=>{
        if(!playerCards[player].includes(c)) playerCards[player].push(c);
      });
    });
  }

  if(res==="shown" || (res==="clue" && !didntSee)){
    shownCards.forEach(c=>{ eliminated[c]=true; prob[c]=0; animateClue(c); });
  }
  if(res==="unknownshow") [guessPerson.value,guessWeapon.value,guessRoom.value].forEach(c=>prob[c]*=0.7);
  if(res==="noshow") [guessPerson.value,guessWeapon.value,guessRoom.value].forEach(c=>prob[c]*=1.5);
  normalizeAll();

  playersWhoShowed.clear();
  shownCards.clear();
  clueNotSeen.checked=false;
  renderAll();
  updateLog();
}

function processTurnWithFlash(btn){ btn.classList.add("flash"); setTimeout(()=>btn.classList.remove("flash"),500); processTurn(); }
function nextTurn(){ if(!players.length)return; turnIndex=(turnIndex+1)%players.length; document.getElementById("currentPlayer").innerText=players[turnIndex]; }
function nextTurnWithFlash(btn){ btn.classList.add("flash"); setTimeout(()=>btn.classList.remove("flash"),500); nextTurn(); }

function animateClue(card){ setTimeout(()=>{
  const el=[...document.querySelectorAll(".card")].find(e=>e.innerText===card);
  if(el){ el.classList.add("clue-reveal"); setTimeout(()=>el.classList.remove("clue-reveal"),900); }
},50); }

function suggest(){ const best=a=>a.reduce((x,y)=>prob[x]>prob[y]?x:y); suggestion.innerText=`üéØ ${best(people)} with the ${best(weapons)} in the ${best(rooms)}`; }

function renderSetup(){ setupCards.innerHTML=""; allCards.forEach(c=>{ const d=document.createElement("div"); d.className="card"+(eliminated[c]?" eliminated":""); d.innerText=c; d.onclick=()=>{ eliminated[c]=!eliminated[c]; prob[c]=eliminated[c]?0:1; normalizeAll(); renderAll(); }; setupCards.appendChild(d); }); }
function renderCards(){ cards.innerHTML=""; allCards.forEach(c=>{ const d=document.createElement("div"); d.className="card"+(eliminated[c]?" eliminated":"")+(uncertain[c]?" uncertain":""); d.innerHTML=`<strong>${c}</strong><div class="prob">${(prob[c]*100).toFixed(1)}%</div>`; d.onclick=()=>{uncertain[c]=!uncertain[c];renderCards()}; cards.appendChild(d); }); }
function fill(id,arr){arr.forEach(v=>document.getElementById(id).add(new Option(v,v)));}
function renderAll(){ renderSetup(); renderPlayers(); renderShownCards(); renderCards(); }

function updateLog(){
  logPanel.innerHTML="";
  players.forEach(p=>{
    const div=document.createElement("div");
    const cardsHTML=playerCards[p].map(c=>{
      const cls=eliminated[c]?"elim":"seen";
      return `<span class="log-card ${cls}">${c}</span>`;
    }).join(" ");
    div.innerHTML=`<strong>${p}:</strong> ${cardsHTML || "(no cards yet)"}`;
    logPanel.appendChild(div);
  });
}

function toggleLog(){ logPanel.style.display=logPanel.style.display==="block"?"none":"block"; }

fill("guessPerson",people); fill("guessWeapon",weapons); fill("guessRoom",rooms); renderAll();
</script>
</body>
</html>
