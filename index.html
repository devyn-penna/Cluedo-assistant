<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cluedo Assistant</title>
<style>
body { font-family: Arial,sans-serif; background:#1a1a1a; color:#e5e5e5; padding:20px;}
h1,h2{margin-bottom:10px;}
label{display:block;margin-top:10px;}
button,select,input{width:100%;padding:6px;margin-top:4px;border-radius:8px;border:none;}
button{background:#4b5563;color:#e5e5e5;cursor:pointer;margin-top:10px;}
button:hover{background:#6b7280;}
button.danger{background:#dc2626;color:white;}
.panel{background:#111;padding:14px;border-radius:14px;margin-bottom:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;}
.card{padding:10px;border-radius:12px;background:#2d2d2d;text-align:center;cursor:pointer;user-select:none;}
.card.eliminated{background:#dc2626;opacity:0.6;pointer-events:none;}
.card.selected{background:#16a34a;} /* green for selected shown cards */
.disabled{opacity:0.4;pointer-events:none;}
.prob{font-size:13px;opacity:.85;text-align:center;}
.checkbox-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:5px;}
</style>
</head>
<body>
<h1>üïµÔ∏è Cluedo Assistant</h1>

<div class="panel">
<h2>Setup ‚Äì Your Starting Hand</h2>
<p>Click any cards you already have to cross them off.</p>
<div class="grid" id="setupCards"></div>
</div>

<div class="panel">
<h2>Players & Identity</h2>
<label>Players (in order, comma separated)</label>
<input id="playersInput" placeholder="Devyn,Lisa,Caiden,Xavier">
<button onclick="setPlayers()">Set Players</button>

<label>I am:</label>
<select id="currentUserSelect" onchange="currentUser=document.getElementById('currentUserSelect').value;"></select>
<p><strong>Current Turn:</strong> <span id="currentPlayer">Not set</span></p>
</div>

<div class="panel">
<h2>Current Go</h2>
<label>Person guessed</label>
<select id="guessPerson"></select>
<label>Weapon guessed</label>
<select id="guessWeapon"></select>
<label>Room guessed</label>
<select id="guessRoom"></select>

<label>What happened?</label>
<select id="result" onchange="updateUI()">
<option value="shown">A card was shown and I saw it</option>
<option value="unknownshow">A card was shown but I didn‚Äôt see it</option>
<option value="noshow">No one could show</option>
<option value="random">Random clue card revealed</option>
</select>

<label>Which players showed a card? (select multiple)</label>
<div id="playersShown" class="checkbox-grid"></div>

<label>Which card(s) were shown? (click to select, multi-select)</label>
<div id="shownCards" class="grid"></div>

<label>If random clue but not seen?</label>
<select id="randomUnknown" onchange="updateUI()">
<option value="no">No, I saw it</option>
<option value="yes">Yes, I didn‚Äôt see it</option>
</select>

<button onclick="processTurn()">Process Turn</button>
<button onclick="nextTurn()">Skip Player Turn</button>
</div>

<h2>Probabilities</h2>
<div class="grid" id="cards"></div>
<button class="danger" onclick="suggest()">üéØ Most Likely Guess</button>
<h2 id="suggestion"></h2>

<script>
// --- Data ---
var people=["Devyn","Lisa","Caiden","Xavier","Leo","Claudia"];
var weapons=["Dave","Pool Stick","Nerf Gun","Cricket Bat","Knife","Banana"];
var rooms=["Playroom","Bathroom","Devyns Bedroom","Lisas Bedroom","Caicens Bedroom","Kitchen","Toilet","Dining Room","Lounge"];
var allCards=people.concat(weapons,rooms);

var prob={}, eliminated={}, startingHand=[], players=[], turnIndex=0, currentUser="";

allCards.forEach(c=>{prob[c]=1; eliminated[c]=false;});

// --- Setup Hand ---
function toggleStartCard(card){
  var idx=startingHand.indexOf(card);
  if(idx===-1){ startingHand.push(card); eliminated[card]=true; prob[card]=0; }
  else{ startingHand.splice(idx,1); eliminated[card]=false; prob[card]=1; }
  normalizeAll(); render(); renderSetup(); renderPlayers(); renderShownCards();
}

function renderSetup(){
  var box=document.getElementById('setupCards');
  box.innerHTML="";
  allCards.forEach(c=>{
    var btn=document.createElement('button');
    btn.className='card'+(eliminated[c]?' eliminated':'');
    btn.innerText=c;
    btn.onclick=()=>toggleStartCard(c);
    box.appendChild(btn);
  });
}

// --- Players ---
function setPlayers(){
  players=document.getElementById('playersInput').value.split(',').map(p=>p.trim()).filter(Boolean);
  turnIndex=0;
  document.getElementById('currentPlayer').innerText=players[turnIndex]||'Not set';
  renderPlayers();
}

function renderPlayers(){
  var select=document.getElementById('currentUserSelect');
  select.innerHTML="";
  players.forEach(p=>{let o=document.createElement('option'); o.text=p; select.add(o);});
  currentUser=select.value;

  var shownDiv=document.getElementById('playersShown');
  shownDiv.innerHTML="";
  players.forEach(p=>{
    let label=document.createElement('label');
    label.innerHTML=`<input type="checkbox" value="${p}"> ${p}`;
    shownDiv.appendChild(label);
  });
}

// --- Probabilities ---
function normalize(arr){let total=0; arr.forEach(c=>total+=prob[c]); arr.forEach(c=>prob[c]=total?prob[c]/total:0);}
function normalizeAll(){normalize(people);normalize(weapons);normalize(rooms);}
function render(){
  var box=document.getElementById('cards'); box.innerHTML="";
  allCards.forEach(c=>{
    var div=document.createElement('div');
    div.className='card'+(eliminated[c]?' eliminated':'');
    div.innerHTML=`<strong>${c}</strong><div class="prob">${(prob[c]*100).toFixed(1)}%</div>`;
    box.appendChild(div);
  });
}

// --- Fill guess dropdowns ---
function fill(id,arr){
  var el=document.getElementById(id); el.innerHTML="";
  arr.forEach(v=>{var o=document.createElement('option'); o.text=v; el.add(o);});
}

// --- Shown Cards UI (no subheadings) ---
function renderShownCards(){
  var box=document.getElementById('shownCards');
  box.innerHTML="";
  allCards.forEach(c=>{
    var btn=document.createElement('button');
    btn.className='card'+(eliminated[c]?' eliminated':'');
    btn.innerText=c;
    btn.onclick=()=>{ btn.classList.toggle('selected'); };
    box.appendChild(btn);
  });
}

// --- UI Update ---
function updateUI(){
  var res=document.getElementById('result').value;
  var unseen=document.getElementById('randomUnknown').value==='yes';
  var randomBox=document.getElementById('randomUnknown');

  ['guessPerson','guessWeapon','guessRoom','randomUnknown'].forEach(id=>document.getElementById(id).classList.remove('disabled'));

  if(res==='random'){
    ['guessPerson','guessWeapon','guessRoom'].forEach(id=>document.getElementById(id).classList.add('disabled'));
    randomBox.classList.remove('disabled');
  } else {
    randomBox.classList.add('disabled');
  }
}

// --- Turn Processing ---
function processTurn(){
  var p=document.getElementById('guessPerson').value;
  var w=document.getElementById('guessWeapon').value;
  var r=document.getElementById('guessRoom').value;
  var res=document.getElementById('result').value;
  var unseen=document.getElementById('randomUnknown').value==='yes';

  var shownPlayers=Array.from(document.querySelectorAll('#playersShown input:checked')).map(i=>i.value);
  var shownCards=Array.from(document.querySelectorAll('#shownCards .card.selected')).map(b=>b.innerText);

  if(currentUser && (res==='shown' || (res==='random' && !unseen))){
    shownCards.forEach(c=>{eliminated[c]=true; prob[c]=0;});
  }

  if(res==='unknownshow'){
    [p,w,r].forEach(c=>prob[c]*=0.7);
    let possible=[p,w,r].filter(c=>!startingHand.includes(c) && !eliminated[c]);
    if(possible.length===1){eliminated[possible[0]]=true; prob[possible[0]]=0;}
  }
  if(res==='noshow'){[p,w,r].forEach(c=>prob[c]*=1.5);}
  if(res==='random'){
    if(unseen) allCards.forEach(c=>prob[c]*=0.97);
    [p,w,r].forEach(c=>prob[c]*=1.2);
  }

  normalizeAll(); render(); renderSetup(); renderPlayers(); updateUI(); renderShownCards();
  if(res!=='random') nextTurn();
}

function nextTurn(){
  if(!players.length) return;
  turnIndex=(turnIndex+1)%players.length;
  document.getElementById('currentPlayer').innerText=players[turnIndex];
}

function suggest(){
  function best(arr){return arr.reduce((a,b)=>prob[a]>prob[b]?a:b);}
  document.getElementById('suggestion').innerText='üéØ '+best(people)+' with the '+best(weapons)+' in the '+best(rooms);
}

// --- Initialize ---
fill('guessPerson',people); fill('guessWeapon',weapons); fill('guessRoom',rooms);
renderSetup(); renderPlayers(); renderShownCards(); render(); updateUI();
</script>
</body>
</html>
