<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cluedo Assistant</title>

<style>
body{
  font-family:Arial,sans-serif;
  background:#1a1a1a;
  color:#e5e5e5;
  padding:20px;
}
h1,h2{margin-bottom:10px}

button,select,input{
  width:100%;
  padding:6px;
  margin-top:6px;
  border-radius:8px;
  border:none;
}

button{
  background:#4b5563;
  color:white;
  cursor:pointer;
}
button:hover{background:#6b7280}
button.danger{background:#dc2626}

.panel{
  background:#111;
  padding:14px;
  border-radius:14px;
  margin-bottom:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;
}

.card{
  background:#2d2d2d;
  padding:10px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  position:relative;
  transition:transform .4s, box-shadow .4s, opacity .4s;
}

.card.selected{ outline:3px solid #3b82f6 }
.card.eliminated{ background:#dc2626; opacity:.6 }

.card.uncertain::after{
  content:"?";
  position:absolute;
  top:2px; right:6px;
  font-size:26px;
  font-weight:bold;
  color:#3b82f6;
}

/* üîÆ CLUE REVEAL ANIMATION */
.card.clue-reveal{
  animation:clueFlip .8s ease forwards;
  box-shadow:0 0 20px #3b82f6;
}

@keyframes clueFlip{
  0%{ transform:rotateY(90deg); opacity:0 }
  50%{ opacity:1 }
  100%{ transform:rotateY(0deg) }
}

.player-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
  gap:10px;
}

.player-btn{
  background:#374151;
  padding:10px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  position:relative;
}

.player-btn.selected{ background:#2563eb }
.player-btn.selected::after{
  content:"üîµ";
  position:absolute;
  top:4px; right:6px;
}

.greyed{
  opacity:.35;
  pointer-events:none;
}

.prob{ font-size:13px; opacity:.85 }
</style>
</head>

<body>
<h1>üïµÔ∏è Cluedo Assistant</h1>

<div class="panel">
<h2>Setup ‚Äì Your Starting Hand</h2>
<div class="grid" id="setupCards"></div>
</div>

<div class="panel">
<h2>Players</h2>

<label>Players (comma separated)</label>
<input id="playersInput" placeholder="Devyn,Lisa,Caiden,Xavier">

<button onclick="setPlayers()">Set Players</button>

<label>I am:</label>
<select id="currentUserSelect" onchange="currentUser=this.value"></select>

<p><strong>Current Turn:</strong> <span id="currentPlayer">‚Äì</span></p>
</div>

<div class="panel">
<h2>Current Go</h2>

<label>Person</label>
<select id="guessPerson"></select>

<label>Weapon</label>
<select id="guessWeapon"></select>

<label>Room</label>
<select id="guessRoom"></select>

<label>What happened?</label>
<select id="result" onchange="handleResultChange()">
  <option value="shown">A card was shown and I saw it</option>
  <option value="unknownshow">A card was shown but I didn‚Äôt see it</option>
  <option value="noshow">No one could show</option>
  <option value="clue">Random clue card revealed</option>
</select>

<div id="clueSeenWrapper" style="display:none; margin-top:10px;">
  <label>
    <input type="checkbox" id="clueNotSeen">
    I didn‚Äôt see the clue card
  </label>
</div>

<label>Who showed a card?</label>
<div class="player-grid" id="playerShownGrid"></div>

<label>Which card(s) were shown?</label>
<div class="grid" id="shownCardGrid"></div>

<button onclick="processTurn()">Process Event</button>
<button onclick="nextTurn()">End Turn</button>
</div>

<h2>Probabilities</h2>
<div class="grid" id="cards"></div>

<button class="danger" onclick="suggest()">üéØ Most Likely Guess</button>
<h2 id="suggestion"></h2>

<script>
const people=["Devyn","Lisa","Caiden","Xavier","Leo","Claudia"];
const weapons=["Dave","Pool Stick","Nerf Gun","Cricket Bat","Knife","Banana"];
const rooms=["Playroom","Bathroom","Devyns Bedroom","Lisas Bedroom","Caicens Bedroom","Kitchen","Toilet","Dining Room","Lounge"];
const allCards=[...people,...weapons,...rooms];

let prob={}, eliminated={}, uncertain={};
let players=[], turnIndex=0, currentUser="";
let playersWhoShowed=new Set();
let shownCards=new Set();

allCards.forEach(c=>{
  prob[c]=1; eliminated[c]=false; uncertain[c]=false;
});

function setPlayers(){
  players=playersInput.value.split(",").map(p=>p.trim()).filter(Boolean);
  turnIndex=0;
  currentPlayer.innerText=players[0]||"‚Äì";
  renderPlayers();
}

function renderPlayers(){
  currentUserSelect.innerHTML="";
  players.forEach(p=>currentUserSelect.add(new Option(p,p)));
  currentUser=currentUserSelect.value;

  playerShownGrid.innerHTML="";
  players.forEach(p=>{
    const d=document.createElement("div");
    d.className="player-btn"+(playersWhoShowed.has(p)?" selected":"");
    d.innerText=p;
    d.onclick=()=>{
      playersWhoShowed.has(p)?playersWhoShowed.delete(p):playersWhoShowed.add(p);
      renderPlayers();
    };
    playerShownGrid.appendChild(d);
  });
}

function renderShownCards(){
  shownCardGrid.innerHTML="";
  allCards.forEach(c=>{
    const d=document.createElement("div");
    d.className="card"+(shownCards.has(c)?" selected":"");
    d.innerText=c;
    d.onclick=()=>{
      shownCards.has(c)?shownCards.delete(c):shownCards.add(c);
      renderShownCards();
    };
    shownCardGrid.appendChild(d);
  });
}

function handleResultChange(){
  const isClue=result.value==="clue";
  clueSeenWrapper.style.display=isClue?"block":"none";
  playerShownGrid.classList.toggle("greyed",isClue);
}

function normalize(arr){
  let t=arr.reduce((s,c)=>s+prob[c],0);
  arr.forEach(c=>prob[c]=t?prob[c]/t:0);
}
function normalizeAll(){normalize(people);normalize(weapons);normalize(rooms);}

function processTurn(){
  const p=guessPerson.value,w=guessWeapon.value,r=guessRoom.value;
  const res=result.value;
  const didntSee=clueNotSeen.checked;

  if(res==="shown"){
    shownCards.forEach(c=>{ eliminated[c]=true; prob[c]=0; });
  }

  if(res==="unknownshow") [p,w,r].forEach(c=>prob[c]*=0.7);
  if(res==="noshow") [p,w,r].forEach(c=>prob[c]*=1.5);

  if(res==="clue" && !didntSee){
    shownCards.forEach(c=>{
      eliminated[c]=true;
      prob[c]=0;
      animateClue(c);
    });
  }

  normalizeAll();
  playersWhoShowed.clear();
  shownCards.clear();
  clueNotSeen.checked=false;
  renderAll();
}

function animateClue(card){
  setTimeout(()=>{
    const el=[...document.querySelectorAll(".card")].find(e=>e.innerText===card);
    if(el){
      el.classList.add("clue-reveal");
      setTimeout(()=>el.classList.remove("clue-reveal"),900);
    }
  },50);
}

function nextTurn(){
  if(!players.length)return;
  turnIndex=(turnIndex+1)%players.length;
  currentPlayer.innerText=players[turnIndex];
}

function suggest(){
  const best=a=>a.reduce((x,y)=>prob[x]>prob[y]?x:y);
  suggestion.innerText=`üéØ ${best(people)} with the ${best(weapons)} in the ${best(rooms)}`;
}

function renderSetup(){
  setupCards.innerHTML="";
  allCards.forEach(c=>{
    const d=document.createElement("div");
    d.className="card"+(eliminated[c]?" eliminated":"");
    d.innerText=c;
    d.onclick=()=>{
      eliminated[c]=!eliminated[c];
      prob[c]=eliminated[c]?0:1;
      normalizeAll();
      renderAll();
    };
    setupCards.appendChild(d);
  });
}

function renderCards(){
  cards.innerHTML="";
  allCards.forEach(c=>{
    const d=document.createElement("div");
    d.className="card"+(eliminated[c]?" eliminated":"")+(uncertain[c]?" uncertain":"");
    d.innerHTML=`<strong>${c}</strong><div class="prob">${(prob[c]*100).toFixed(1)}%</div>`;
    d.onclick=()=>{uncertain[c]=!uncertain[c];renderCards()};
    cards.appendChild(d);
  });
}

function fill(id,arr){arr.forEach(v=>document.getElementById(id).add(new Option(v,v)))}

function renderAll(){
  renderSetup();
  renderPlayers();
  renderShownCards();
  renderCards();
}

fill("guessPerson",people);
fill("guessWeapon",weapons);
fill("guessRoom",rooms);
renderAll();
</script>
</body>
</html>
